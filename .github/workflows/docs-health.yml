name: Docs Health

on:
  pull_request:
  push:
    branches:
      - main

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Validate Docs Health
        run: |
          python scripts/docs_health.py \
            --baseline-file .github/baselines/broken-local-links.txt \
            --json-output docs-health-report.json

      - name: Validate Tutorial Manifest Is Current
        run: |
          python scripts/generate_tutorial_manifest.py --output /tmp/tutorial-manifest.json
          diff -u tutorials/tutorial-manifest.json /tmp/tutorial-manifest.json

      - name: Validate Discoverability Assets Are Current
        run: |
          python scripts/generate_discoverability_assets.py \
            --output-json /tmp/tutorial-index.json \
            --llms /tmp/llms.txt \
            --llms-full /tmp/llms-full.txt
          diff -u discoverability/tutorial-index.json /tmp/tutorial-index.json
          diff -u llms.txt /tmp/llms.txt
          diff -u llms-full.txt /tmp/llms-full.txt
